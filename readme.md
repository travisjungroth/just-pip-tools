# just pip-tools

This is an example of using [pip-tools](https://github.com/jazzband/pip-tools/) with [just](https://github.com/casey/just) to manage Python dependencies. The purpose is to quickly and consistently manage multiple layers of Python dependencies. This is _not_ an all-in-one magic solution. It's a few files that you can tweak to your needs.

Dependencies are split into three [layers](https://github.com/jazzband/pip-tools#workflow-for-layered-requirements):

- main: Dependencies that will run in production or are required by your library.
- dev: Dependencies that are included for all developers, CI, test environments, etc.
- local: Dependencies that are only for the current developer.

Each of these levels has a `.in` file in `requirements` that holds the top level dependencies. These dependencies are unpinned or minimally pinned.

The lock files are generated by pip-tools. They're in `requirements/locks`. Each level is constrained by the levels before it.

When syncing an environment, you sync that level and all levels before it. This means your local environment will have the exact same dependencies as production, but also some more from dev and local.

There is also a `setup-venv` command which will create a virtual environment on MacOS. You could remove, simplify or replace this command.

## Usage

### Version Control

The requirements files all live in version control, except the local versions. If you have a merge conflict, resolve it manually in the `.in` file. Then run `just lock` to regenerate the lock files.

### Help

View the commands by running `just`.

### Modifying dependencies

Add a dependency with `just add-dependency ENVIRONMENT DEPENDENCY` such as:
 
    just add-dependency dev black

To edit or remove a dependency, edit the `.in` file and run `just lock sync`.

### Installing dependencies

    just sync

This will install all dependencies. On CI or test servers, run `just sync dev`. 

For production, you'll likely not have these tools installed and will run something like:
    
    python -m pip install -r requirements/locks/main.txt


## Adding to your project

1. Copy `pip-tools.toml` to your project or add it to your `pyproject.toml`.
2. Copy `justfile` to your project or add it to your `justfile`.
3. Copy the `requirements` directory to your project and add your dependencies to the `.in` files.
4. Install [just](https://github.com/casey/just#installation).
5. If using the included `setup-env`, add a `.python-version` file to your project. Install [homebrew](https://docs.brew.sh/Installation) and [pyenv](https://formulae.brew.sh/formula/pyenv). If not, then modify or remove the `setup-env` command.